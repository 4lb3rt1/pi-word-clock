#!/usr/bin/python

import time
from LEDGrid import LEDGrid
from datetime import datetime

def scrollMessage(message,font):
    print message

def rotateFontCCW(font):
    for c in font:
        font[c]=grid.rotateCCW(font[c])

def demo(message='',font=None,delay=1):
    for m in message:
        grid.showChar(font[m])
        time.sleep(delay)

def merge(words):
    char=[0,0,0,0,0,0,0,0]
    for w in words:
        for x in range(0,8):
            char[x]=char[x] | w[x]
    return char
        

def showTime(font=None):
    words=[]
    now=datetime.now()
    hour=now.hour
    minute=now.minute
    if minute>=5 and minute <10:
        words=['m_5','past']
    elif minute>=10 and minute <15:
        words=['m_10','past']
    elif minute>=15 and minute <20:
        words=['m_15','past']
    elif minute>=20 and minute <25:
        words=['m_20','past']
    elif minute>=25 and minute <30:
        words=['m_25','past']
    elif minute>=30 and minute <35:
        words=['m_30','past']
        print 'half past'
    elif minute>=35 and minute <40:
        words=['m_25','to']
    elif minute>=40 and minute <45:
        words=['m_20','to']
    elif minute>=45 and minute <50:
        words=['m_15','to']
    elif minute>=50 and minute <55:
        words=['m_10','to']
    elif minute>=55 and minute <60:
        words=['m_5','to']
    if hour>12:
        hour-=12
    if hour==0:
        hour=12
    words.append('h_'+str(hour))
    chars=[]
    for w in words:
        chars.append(font[w])
    grid.showChar(merge(chars))

        
        

grid=LEDGrid(address=0x70,debug=False)
grid.setBrightness(0)
print "Pi Word Clock"
smile=[0x3C,0x42,0x95,0xA1,0xA1,0x95,0x42,0x3c]
empty=[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]
all_on=[0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff]
past=[0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00]
arrow=[0x18,0x24,0x42,0xff,0x18,0x18,0x18,0x18]
invader1=[0x18,0x3c,0x7e,0xdb,0xff,0x24,0x5a,0xa5]
invader2=[0x18,0x3c,0x7e,0xdb,0xff,0x24,0x5a,0x42]
invader1=(grid.rotateCCW(invader1))
clockFont1={
    'past':[0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00],
    'to':[0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00],
    'h_1':[0x00,0x00,0x00,0x00,0xe0,0x00,0x00,0x00],
    'h_2':[0x00,0x00,0x00,0x00,0x00,0xc0,0x40,0x00],
    'h_3':[0x00,0x00,0x00,0x00,0x1f,0x00,0x00,0x00],
    'h_4':[0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00],
    'h_5':[0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x00],
    'h_6':[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xe0],
    'h_7':[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1f],
    'h_8':[0x00,0x00,0x00,0x1f,0x00,0x00,0x00,0x00],
    'h_9':[0x00,0x00,0x00,0xf0,0x00,0x00,0x00,0x00],
    'h_10':[0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00],
    'h_11':[0x00,0x00,0x00,0x00,0x00,0x3f,0x00,0x00],
    'h_12':[0x00,0x00,0x00,0x00,0x00,0xf6,0x00,0x00],
    'm_5':[0x00,0xd4,0x00,0x00,0x00,0x00,0x00,0x00],
    'm_10':[0x00,0x0d,0x00,0x00,0x00,0x00,0x00,0x00],
    'm_15':[0x00,0xef,0x00,0x00,0x00,0x00,0x00,0x00],
    'm_20':[0x3f,0x00,0x00,0x00,0x00,0x00,0x00,0x00],
    'm_25':[0x3f,0xd4,0x00,0x00,0x00,0x00,0x00,0x00],
    'm_30':[0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x00]
            }
rotateFontCCW(clockFont1)
##grid2=LEDGrid(address=0x71,debug=False)
##grid2.showChar(invader1)
##grid2.setBrightness(1)
##demo(['past','to','h_1','h_2','h_3','h_4','h_5','h_6','h_7','h_8','h_9','h_10','h_11','h_12','m_5','m_10','m_15','m_20','m_25','m_30'],clockFont1,0.25)
while True:
    showTime(clockFont1)
    
